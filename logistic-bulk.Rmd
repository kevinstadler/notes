---
title: Empirical approaches to the logistic function
author: Kevin Stadler
date: December 3, 2014
output: pdf_document
classoption: a4paper
---

One rather unintuitive property of the logistic function

$$x(t)=\frac{1}{1+e^{-r(t-t_0)}}$$

is that it only reaches its initial value (0) and final value (1 or $K$) *in the limit*, i.e. as $t\rightarrow\pm\infty$. When using small sample sizes, the minute changes that happen at the extreme ends of the curve can be very noisy and are generally not of a lot of interest. More important to grasp is whether the data points just off the largely linear portion around the inflection point of the logistic curve conform to logistic growth or not. The different sub-portions of the curve (within which 10/20/30/40/...% of the change happens) stand in a non-trivial relationship to each other, as can be seen from the plot and table below.

```{r echo=FALSE, results='asis'}
logistic <- function(t, r=1, t0=0)
  plogis(t, t0, 1/r)
#  1/(1+exp(-r*(t-t0)))

# returns the overall time needed for the logistic function to cover the amount
# of growth specified by bulk, i.e. the time it takes to go from 0.5-bulk/2 to
# 0.5+bulk/2
bulkofchange <- function(bulk, rate=1) {
  threshold <- (1+bulk)/2
  -2*log((1-threshold)/threshold)/rate
}

lfit <- function(b, rate=1, what="coefficients") {
  t <- bulkofchange(b, rate)
  ts <- -100:100 * (t/100)
  lm.fit(as.matrix(ts), logistic(ts, rate))[[what]]
}

bulk <- c(10, 20, 30, 40, 50, 60, 70, 80, 90)

limit <- bulkofchange(0.99)/2
curve(logistic, from=-limit, to=limit, xaxs="i", yaxs="i", xlab="t", ylab="logistic(t, r=1)", ylim=0:1)

d <- data.frame(bulk=bulk/100, time=bulkofchange(bulk/100), linear.fit=sapply(bulk/100, lfit))

null <- mapply(function(b,t){rect(-t/2, 0.5-b/2, t/2, 0.5+b/2, lty=2, border="gray")}, d$bulk, d$time)

knitr::kable(data.frame(bulk=paste(bulk, "%", sep=""), time=paste(round(d$time, digits=3), "r", sep="/"), linear.fit=paste(round(d$linear.fit, digits=4), "\\*", "r")))
```

The growth rate of the logistic function has its highest value at the inflection point, where the slope is $\frac{r}{4}$.

Using this approach we can also test how far away from the inflection point we have to collect data so that the linear fit breaks down as a good model of data that is actually generated by logistic growth.

```{r echo=FALSE, fig.height=3.8}
curve({sapply(x, lfit)}, from=0.01, to=0.99, xaxs="i", xlim=0:1, ylim=c(0, 0.25), xlab="Difference between lowest and highest data point", ylab="Estimated linear rate")

curve({sapply(x, function(x)sum(abs(0.5-lfit(x,what="residuals"))))/101}, from=0.01, to=0.99, xaxs="i", xlim=0:1, ylim=c(0, 0.3), xlab="Difference between lowest and highest data point", ylab="Average error per datapoint")

curve({sapply(x, function(x)-x/2-lfit(x,what="fitted.values")[1])}, from=0.01, to=0.99, xaxs="i", xlim=0:1, xlab="Difference between lowest and highest data point", ylab="Prediction error for the most extreme datapoint")
```
